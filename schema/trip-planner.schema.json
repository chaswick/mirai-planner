{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/trip-planner.schema.json",
  "title": "Trip Planner Data Model",
  "type": "object",
  "additionalProperties": false,

  "required": [
    "version",
    "kpi_mappings",
    "activities_catalog",
    "day_collection",
    "segment_collection",
    "trip_itinerary"
  ],

  "properties": {
    "version": { "type": "string" },

    "kpi_mappings": {
      "type": "object",
      "description": "Condensed KPI map: keys are KPI names; values are arrays of experience tags.",
      "additionalProperties": {
        "type": "array",
        "items": { "$ref": "#/$defs/NonEmptyString" },
        "uniqueItems": true
      },
      "minProperties": 1
    },

    "activities_catalog": {
      "type": "array",
      "description": "Catalog of available activities.",
      "items": { "$ref": "#/$defs/Activity" },
      "minItems": 1,
      "uniqueItems": true
    },

    "day_collection": {
      "type": "array",
      "description": "Collection of days in the trip.",
      "items": { "$ref": "#/$defs/Day" },
      "minItems": 1
    },

    "segment_collection": {
      "type": "array",
      "description": "Higher-level groupings of related days.",
      "items": { "$ref": "#/$defs/Segment" },
      "minItems": 1
    },

    "trip_itinerary": {
      "type": "array",
      "description": "Top-level trip groupings (collection of segments).",
      "items": { "$ref": "#/$defs/TripItem" },
      "minItems": 1
    }
    ,
    "hotels": {
      "type": "array",
      "description": "Optional list of hotels / places where travelers stay.",
      "items": { "$ref": "#/$defs/Hotel" },
      "uniqueItems": true
    }
  },

  "$defs": {
    "NonEmptyString": {
      "type": "string",
      "minLength": 1
    },

    "ISODate": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "YYYY-MM-DD"
    },

    "DateRangeString": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}\\s+to\\s+\\d{4}-\\d{2}-\\d{2}$",
      "description": "Format: 'YYYY-MM-DD to YYYY-MM-DD'"
    },

    "FixedHours": {
      "type": "string",
      "enum": ["08:00-11:00am", "12:00pm-04:00pm", "05:00pm-08:00pm"]
    },

    "TransitKPI": {
      "type": "string",
      "pattern": "^[A-Za-z][A-Za-z\\s/]*(?::[A-Za-z0-9_-]+)?$",
      "description": "Mode or Mode:ID (e.g., 'Airplane' or 'Airplane:JL0001'). Reuse the same ID across parts to mark a continuing leg; omit the ID for one-off hops."
    },

    "ActivityLogistics": {
      "type": "object",
      "additionalProperties": false,
      "required": ["activity_hours"],
      "properties": {
        "activity_hours": {
          "type": "number",
          "minimum": 0,
          "description": "Estimated duration in hours for the activity."
        },
        "notes": {
          "type": "string",
          "description": "Optional notes for the activity."
        }
        ,"location": { "$ref": "#/$defs/GeoPoint" },
        "address": { "type": "string" },
        "latitude": { "type": "number", "minimum": -90, "maximum": 90 },
        "longitude": { "type": "number", "minimum": -180, "maximum": 180 }
      }
    },

    "GeoPoint": {
      "type": "object",
      "additionalProperties": false,
      "required": ["lat","lng"],
      "properties": {
        "lat": { "type": "number", "minimum": -90, "maximum": 90 },
        "lng": { "type": "number", "minimum": -180, "maximum": 180 }
      }
    },

    "Hotel": {
      "type": "object",
      "additionalProperties": false,
      "required": ["authoritative_name","name","address","location"],
      "properties": {
        "authoritative_name": { "$ref": "#/$defs/NonEmptyString" },
        "name": { "$ref": "#/$defs/NonEmptyString" },
        "address": { "type": "string" },
        "location": { "$ref": "#/$defs/GeoPoint" },
        "amenities": {
          "type": "array",
          "items": { "$ref": "#/$defs/NonEmptyString" },
          "uniqueItems": true
        },
        "check_in": { "type": "string", "pattern": "^\\d{2}:\\d{2}$", "description": "HH:MM (local)" },
        "check_out": { "type": "string", "pattern": "^\\d{2}:\\d{2}$", "description": "HH:MM (local)" },
        "reservation_number": { "type": "string" },
        "contact": { "type": "string" }
      }
    },

    "Activity": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "authoritative_name",
        "descriptive_name",
        "descriptive_text",
        "experiences",
        "kid_friendly",
        "logistics"
      ],
      "properties": {
        "authoritative_name": { "$ref": "#/$defs/NonEmptyString" },
        "descriptive_name": { "$ref": "#/$defs/NonEmptyString" },
        "descriptive_text": {
          "type": "string",
          "description": "Longer narrative description of the activity."
        },
        "experiences": {
          "type": "array",
          "items": { "$ref": "#/$defs/NonEmptyString" },
          "uniqueItems": true,
          "description": "Experience tags like 'history', 'art', 'animals'."
        },
        "kid_friendly": { "type": "boolean" },
        "logistics": { "$ref": "#/$defs/ActivityLogistics" }
      }
    },

    "DayPartName": {
      "type": "string",
      "enum": ["Morning", "Afternoon", "Evening"]
    },

    "DayPartLogistics": {
      "type": "object",
      "additionalProperties": false,
      "required": ["transit_hours", "transit_kpis"],
      "properties": {
        "transit_hours": {
          "type": "number",
          "minimum": 0,
          "description": "Estimated transit time (hours) for this part."
        },
        "transit_kpis": {
          "type": "array",
          "items": { "$ref": "#/$defs/TransitKPI" },
          "uniqueItems": true,
          "minItems": 0
        }
      }
    },

    "DayPartEntry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["part", "hours", "activity_authoritative_name", "logistics"],
      "properties": {
        "part": { "$ref": "#/$defs/DayPartName" },
        "hours": { "$ref": "#/$defs/FixedHours" },
        "activity_authoritative_name": {
          "oneOf": [
            { "$ref": "#/$defs/NonEmptyString" },
            { "type": "null" }
          ],
          "description": "Preferred reference to activities_catalog.authoritative_name or null if open/unscheduled."
        },
        "logistics": { "$ref": "#/$defs/DayPartLogistics" }
      }
    },

    "Day": {
      "type": "object",
      "additionalProperties": false,
      "required": ["date", "overview_text", "day_parts"],
      "properties": {
        "date": { "$ref": "#/$defs/ISODate" },
        "overview_text": { "$ref": "#/$defs/NonEmptyString" },
        "hotel_authoritative_name": {
          "oneOf": [ { "$ref": "#/$defs/NonEmptyString" }, { "type": "null" } ],
          "description": "Reference to a hotels.authoritative_name indicating where the party is staying that day."
        },
        "day_parts": {
          "type": "array",
          "minItems": 3,
          "maxItems": 3,
          "items": [
            {
              "allOf": [
                { "$ref": "#/$defs/DayPartEntry" },
                { "properties": { "part": { "const": "Morning" }, "hours": { "const": "08:00-11:00am" } } }
              ]
            },
            {
              "allOf": [
                { "$ref": "#/$defs/DayPartEntry" },
                { "properties": { "part": { "const": "Afternoon" }, "hours": { "const": "12:00pm-04:00pm" } } }
              ]
            },
            {
              "allOf": [
                { "$ref": "#/$defs/DayPartEntry" },
                { "properties": { "part": { "const": "Evening" }, "hours": { "const": "05:00pm-08:00pm" } } }
              ]
            }
          ]
        }
      }
    },

    "Segment": {
      "type": "object",
      "additionalProperties": false,
      "required": ["title", "date_range", "overview_text"],
      "properties": {
        "title": { "$ref": "#/$defs/NonEmptyString" },
        "date_range": { "$ref": "#/$defs/DateRangeString" },
        "overview_text": { "$ref": "#/$defs/NonEmptyString" }
      }
    },

  "TripItem": {
      "type": "object",
      "additionalProperties": false,
      "required": ["title", "date_range", "overview_text"],
      "properties": {
        "title": { "$ref": "#/$defs/NonEmptyString" },
        "date_range": { "$ref": "#/$defs/DateRangeString" },
        "overview_text": { "$ref": "#/$defs/NonEmptyString" }
      }
    }
  }
}

