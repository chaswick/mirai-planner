<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Date Rendering Test</title>
  <style>
    body { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    h1 { margin: 0 0 12px 0; font-size: 20px; }
    .card { border: 1px solid #e5e7eb; border-radius: 10px; padding: 14px 16px; max-width: 860px; }
    label { font-size: 13px; color: #374151; display:block; margin-bottom:8px; }
    pre { background: #f8fafc; border: 1px solid #e5e7eb; padding: 10px; border-radius: 8px; overflow:auto; }
    table { border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #e5e7eb; padding: 6px 10px; }
    th { background: #f3f4f6; text-align:left; }
    .muted { color: #6b7280; font-size: 12px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Date Rendering Test</h1>
    <label>Trip JSON: <input id="dataFile" type="file" accept=".json,application/json" /></label>
    <button id="runBtn">Run Test</button>
    <div id="out"></div>
  </div>

  <script>
    const $ = (s, el=document) => el.querySelector(s);
    async function readAsJson(file) { const txt = await file.text(); return JSON.parse(txt); }

    function parseDateISO_UTC(d) {
      try {
        const p = String(d || '').split('-').map(Number);
        if (p.length !== 3 || !p[0] || !p[1] || !p[2]) return String(d || '');
        const dt = new Date(Date.UTC(p[0], p[1]-1, p[2]));
        return new Intl.DateTimeFormat(undefined, { weekday: 'short', month: 'short', day: 'numeric', timeZone: 'UTC' }).format(dt);
      } catch { return String(d || ''); }
    }

    function parseDateISO_Local(d) {
      try {
        const dt = new Date(String(d || '') + 'T00:00:00');
        return new Intl.DateTimeFormat(undefined, { weekday: 'short', month: 'short', day: 'numeric' }).format(dt);
      } catch { return String(d || ''); }
    }

    function findFirstDate(days) {
      const list = (days || []).map(d => d.date).filter(Boolean).sort();
      return list.length ? list[0] : null;
    }

    function row(k, v){ return `<tr><th>${k}</th><td>${String(v)}</td></tr>`; }

    $('#runBtn').addEventListener('click', async () => {
      const inp = $('#dataFile');
      if (!(inp.files && inp.files[0])) { alert('Choose a trip JSON'); return; }
      let data;
      try { data = await readAsJson(inp.files[0]); } catch(e){ alert('Invalid JSON: ' + (e?.message||e)); return; }
      const first = findFirstDate(data.day_collection);
      const tzOffsetMin = new Date().getTimezoneOffset();
      const tzSign = tzOffsetMin <= 0 ? '+' : '-';
      const tzHH = String(Math.floor(Math.abs(tzOffsetMin)/60)).padStart(2,'0');
      const tzMM = String(Math.abs(tzOffsetMin)%60).padStart(2,'0');
      const tzStr = `UTC${tzSign}${tzHH}:${tzMM}`;

      const localFmt = first ? parseDateISO_Local(first) : '(n/a)';
      const utcFmt = first ? parseDateISO_UTC(first) : '(n/a)';

      $('#out').innerHTML = [
        '<table>',
        row('Detected timezone', tzStr),
        row('First day (raw string)', first || '(n/a)'),
        row('Local-time formatted', localFmt),
        row('UTC formatted (renderer target)', utcFmt),
        '</table>',
        '<p class="muted">Note: Renderer aims to match the UTC formatted result.</p>'
      ].join('');
    });
  </script>
</body>
</html>
